# helm-template-app-config-extractor


## Description

Generate local files from all the ConfigMap/Secret objects that are mounted in:
- deployments
- pods

Other types of objects (like: statefulset/jobs/cronjobs) have not been tested yet, but extending the code to for those cases should be easy.

Add in the ```parse_helm_template_output``` function in the if condition the new object condition and define the function that will parse the data from that object.

## Usage

#### build
```
docker build --tag helm-template-app-config-extractor:latest .
```

#### run

usage example for app_name

helm code and values is located in /etc/custom_location/helm, but paths can be changed based on your needs.
mount the paths that you have inside the:
/helm/charts - contain the code of the charts
/helm/values - contain the values used by the charts 
/helm/output - contain the configs generated by the helm-template-app-config-extractor

```

export DOCKER_IMAGE_TAG_APP_NAME=addHEREdockerTAGforIMAGEifNEEDED
export CONFIG_PATH=/etc/custom_location/config
export DOCKER_PORT_APP_NAME=80

# code mount
DHELM_CONF_MOUNTS="-v /etc/custom_location/helm/charts:/helm/charts -v /etc/custom_location/helm/values:/helm/values -v $CONFIG_PATH:/helm/output"
DHELM_CONF_IMG="docker-registry.mgmt.sharks.cloud/helm-template-app-config-extractor:latest"

# docker helm config run values
DHELM_CRV=""
DHELM_CRV="$DHELM_CRV -f /helm/values/app_name/stage.yaml"
DHELM_CRV="$DHELM_CRV -f /helm/values/000_SHARED_VALUES/libdependency.conf.yaml"
DHELM_CRV="$DHELM_CRV -f /helm/values/000_SHARED_VALUES/stage-conf-twemproxy-nutcracker.yaml"
DHELM_CRV="$DHELM_CRV --set tag=$DOCKER_IMAGE_TAG_APP_NAME,customValue.exampleURL=http://SERVER_IP:$DOCKER_PORT_APP_NAME"

docker run $DHELM_CONF_MOUNTS $DHELM_CONF_IMG python3 /app/helm-template-get-app-configs.py -l INFO -k deployment -c /helm/output -n ns-template-demo app_name /helm/charts/app_name -- $DHELM_CRV


tree /etc/custom_location/config
# config/
# └── deployment_app_name
#    ├── container_app_name
#    │   └── config
#    │       ├── etc_apache2_conf_logging.conf
#    │       ├── etc_apache2_conf_mpm-prefork-workers.conf
#    │       ├── etc_apache2_conf_reload.conf
#    │       ├── etc_apache2_conf_requests.conf
#    │       ├── oracle
#    │       │   └── tnsnames.ora
#    │       ├── app_name
#    │       │   └── app_name.conf
#    │       └── libdependency
#    │           └── libdependency.conf
#    ├── container_app_name-proc-police
#    │   └── config
#    │       └── etc_profile.d_proc-police.sh
#    └── container_app_name-twemproxy
#        └── config
#            └── nutcracker.yml

```
